<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    
    <script src="https://api.blackcatpagamentos.com/v1/js"></script>

    <title><%= locals.titulo %> - <%= locals.lojaNome %></title>
</head>
<body class="bg-light">

    <div class="promo-bar">
        <i class="bi bi-truck"></i>
        <strong>FRETE GRÁTIS</strong> em compras acima de R$ 30,00!
    </div>

    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/"><%= locals.lojaNome %></a>
            <a href="/" class="btn btn-outline-light btn-sm">Continuar Comprando</a>
        </div>
    </nav>

    <main class="container my-4">
        
        <% if (!locals.clienteLogado) { %>
            <div class="alert alert-warning text-center">
                Você precisa <a href="/login-cliente?redirect=/checkout">fazer login</a> ou <a href="/register">cadastrar-se</a> para finalizar a compra.
            </div>
        <% } else { %>
            
            <ul class="checkout-stepper">
                <li class="step completed"><div class="step-icon"><i class="bi bi-cart-check-fill"></i></div>Carrinho</li>
                <li class="step active"><div class="step-icon">2</div>Pagamento</li>
                <li class="step"><div class="step-icon">3</div>Confirmação</li>
            </ul>

            <h1 class="mb-4"><%= locals.titulo %></h1>
            <div class="row g-5">
                
                <div class="col-md-5">
                    <h2 class="h4 mb-4">Resumo do Pedido</h2>
                    <div class="card shadow-sm">
                        <div class="card-body p-4">
                            <div id="order-summary-items">
                                <div class="text-center p-3"><div class="spinner-border spinner-border-sm"></div><span class="ms-2">Carregando...</span></div>
                            </div>
                            <hr class="my-3">
                            <div class="d-flex justify-content-between fs-5 fw-bold">
                                <span>Total (BRL)</span>
                                <span id="order-total-price">R$ 0,00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-7">
                    <h2 class="h4 mb-4">Dados do Pagamento</h2>
                    
                    <div id="error-message" class="alert alert-danger d-none"></div>

                    <div class="card shadow-sm">
                        <div class="card-body p-4">
                            
                            <h5 class="mb-3">Seus Dados</h5>
                            <form id="payment-form">
                                <div class="mb-3">
                                    <label for="nome" class="form-label">Nome Completo:</label>
                                    <input type="text" class="form-control" id="nome" name="nome" value="<%= locals.clienteLogado.nome %>" required>
                                </div>
                                <div class="mb-3">
                                    <label for="email" class="form-label">E-mail:</label>
                                    <input type="email" class="form-control" id="email" name="email" value="<%= locals.clienteLogado.email %>" required>
                                </div>
                                <div class="mb-3">
                                    <label for="cpf" class="form-label">CPF/CNPJ (Somente números):</label>
                                    <input type="text" class="form-control" id="cpf" name="cpf" placeholder="Necessário para PIX ou Cartão" required>
                                </div>

                                <hr class="my-4">

                                <h5 class="mb-3">Cartão de Crédito</h5>
                                <div class="mb-3">
                                    <label for="cardHolderName" class="form-label">Nome no Cartão:</label>
                                    <input type="text" class="form-control" id="cardHolderName" placeholder="Como está escrito no cartão">
                                </div>
                                <div class="mb-3">
                                    <label for="cardNumber" class="form-label">Número do Cartão:</label>
                                    <input type="text" class="form-control" id="cardNumber" placeholder="0000 0000 0000 0000">
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="cardExpMonth" class="form-label">Mês Venc.:</label>
                                        <input type="text" class="form-control" id="cardExpMonth" placeholder="MM">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="cardExpYear" class="form-label">Ano Venc.:</label>
                                        <input type="text" class="form-control" id="cardExpYear" placeholder="AAAA">
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="cardCvv" class="form-label">CVV:</label>
                                    <input type="text" class="form-control" id="cardCvv" placeholder="123" style="width: 100px;">
                                </div>

                                <div class="d-grid gap-2 mt-4">
                                    <button type="submit" id="pay-with-card-button" class="btn btn-primary btn-lg">Pagar com Cartão</button>
                                    <button type="button" id="pay-with-pix-button" class="btn btn-info btn-lg">Pagar com PIX</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        <% } %> </main>

    <footer class="footer-custom mt-5">
        </footer>
    
    <div class="modal fade" id="pixModal" tabindex="-1" aria-labelledby="pixModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="pixModalLabel">Pague com PIX</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <p>Escaneie o QR Code abaixo com o app do seu banco:</p>
                    <div id="pix-qrcode-container" class="mb-3">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">Gerando QR Code...</span>
                        </div>
                    </div>
                    <p>Ou use o PIX Copia e Cola:</p>
                    <textarea id="pix-copia-cola" class="form-control" rows="4" readonly></textarea>
                    <button id="copy-pix-button" class="btn btn-secondary btn-sm mt-2">Copiar Código</button>
                </div>
                <div class="modal-footer">
                    <p class="text-muted small">Aguardando pagamento... Não feche esta janela.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/checkout-page-blackcat.js"></script> 
</body>
</html>